<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pidgin Data Migration Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }
        .actions {
            margin: 30px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .output {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå∫ Pidgin Data Migration Tool</h1>

        <p>This tool helps convert the legacy JavaScript data format to the new JSON structure.</p>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="legacy-count">-</div>
                <div>Legacy Entries</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="unique-count">-</div>
                <div>Unique Entries</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="duplicates-count">-</div>
                <div>Duplicates Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="categories-count">-</div>
                <div>Categories</div>
            </div>
        </div>

        <div class="actions">
            <button onclick="analyzeLegacyData()">üîç Analyze Legacy Data</button>
            <button onclick="convertData()" id="convert-btn" disabled>üîÑ Convert to New Format</button>
            <button onclick="downloadJSON()" id="download-btn" disabled>üì• Download JSON</button>
            <button onclick="downloadCSV()" id="csv-btn" disabled>üìä Download CSV</button>
            <button onclick="showDuplicates()" id="duplicates-btn" disabled>‚ö†Ô∏è Show Duplicates</button>
        </div>

        <div class="output" id="output">
            Click "Analyze Legacy Data" to start...
        </div>
    </div>

    <!-- Load the legacy data -->
    <script src="../js/comprehensive-pidgin-data.js"></script>
    <script src="../js/data-loader.js"></script>

    <script>
        let convertedData = null;
        let duplicatesList = [];

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : type === 'success' ? 'success' : '';
            output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }

        function analyzeLegacyData() {
            if (typeof comprehensivePidginData === 'undefined') {
                log('‚ùå Legacy data not found!', 'error');
                return;
            }

            log('üìä Analyzing legacy data structure...');

            const entries = Object.entries(comprehensivePidginData);
            const totalEntries = entries.length;

            // Find duplicates
            const seen = new Set();
            const duplicates = [];
            const uniqueEntries = [];

            for (const [key, entry] of entries) {
                if (!entry || !entry.pidgin) {
                    log(`‚ö†Ô∏è Invalid entry found: ${key}`, 'warning');
                    continue;
                }

                const pidginLower = entry.pidgin.toLowerCase();
                if (seen.has(pidginLower)) {
                    duplicates.push({key, entry, pidgin: entry.pidgin});
                } else {
                    seen.add(pidginLower);
                    uniqueEntries.push([key, entry]);
                }
            }

            duplicatesList = duplicates;

            // Count categories
            const categories = new Set();
            uniqueEntries.forEach(([key, entry]) => {
                if (entry.category) categories.add(entry.category);
            });

            // Update stats
            document.getElementById('legacy-count').textContent = totalEntries;
            document.getElementById('unique-count').textContent = uniqueEntries.length;
            document.getElementById('duplicates-count').textContent = duplicates.length;
            document.getElementById('categories-count').textContent = categories.size;

            log(`‚úÖ Analysis complete:`, 'success');
            log(`   Total entries: ${totalEntries}`);
            log(`   Unique entries: ${uniqueEntries.length}`);
            log(`   Duplicates: ${duplicates.length}`);
            log(`   Categories: ${categories.size}`);

            if (duplicates.length > 0) {
                log(`‚ö†Ô∏è Found ${duplicates.length} duplicate pidgin terms`, 'warning');
                document.getElementById('duplicates-btn').disabled = false;
            }

            document.getElementById('convert-btn').disabled = false;
        }

        function convertData() {
            if (typeof comprehensivePidginData === 'undefined') {
                log('‚ùå No legacy data to convert!', 'error');
                return;
            }

            log('üîÑ Converting to new JSON format...');

            // Use the data loader's conversion function
            const loader = new PidginDataLoader();
            convertedData = loader.convertLegacyData(comprehensivePidginData);

            log(`‚úÖ Conversion complete!`, 'success');
            log(`   Converted ${convertedData.entries.length} entries`);
            log(`   Version: ${convertedData.metadata.version}`);
            log(`   Categories: ${Object.keys(convertedData.categories).length}`);

            // Show sample entry
            if (convertedData.entries.length > 0) {
                const sample = convertedData.entries[0];
                log(`üìù Sample entry: "${sample.pidgin}" = [${sample.english.join(', ')}]`);
            }

            document.getElementById('download-btn').disabled = false;
            document.getElementById('csv-btn').disabled = false;
        }

        function downloadJSON() {
            if (!convertedData) {
                log('‚ùå No converted data available!', 'error');
                return;
            }

            const dataStr = JSON.stringify(convertedData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);

            const link = document.createElement('a');
            link.href = url;
            link.download = `pidgin-dictionary-${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            URL.revokeObjectURL(url);
            log('üì• JSON file downloaded!', 'success');
        }

        function downloadCSV() {
            if (!convertedData) {
                log('‚ùå No converted data available!', 'error');
                return;
            }

            const loader = new PidginDataLoader();
            loader.data = convertedData;
            const csvData = loader.exportToCSV();

            const dataBlob = new Blob([csvData], {type: 'text/csv'});
            const url = URL.createObjectURL(dataBlob);

            const link = document.createElement('a');
            link.href = url;
            link.download = `pidgin-dictionary-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();

            URL.revokeObjectURL(url);
            log('üìä CSV file downloaded!', 'success');
        }

        function showDuplicates() {
            if (duplicatesList.length === 0) {
                log('‚úÖ No duplicates found!', 'success');
                return;
            }

            log(`üìã Showing ${duplicatesList.length} duplicate entries:`, 'warning');

            const duplicateGroups = {};
            duplicatesList.forEach(dup => {
                const pidgin = dup.pidgin.toLowerCase();
                if (!duplicateGroups[pidgin]) duplicateGroups[pidgin] = [];
                duplicateGroups[pidgin].push(dup);
            });

            for (const [pidgin, dups] of Object.entries(duplicateGroups)) {
                log(`\n"${pidgin}" appears ${dups.length + 1} times:`);
                dups.forEach(dup => {
                    log(`   Key: "${dup.key}" | English: "${dup.entry.english}"`);
                });
            }
        }

        // Auto-analyze on load
        window.addEventListener('load', () => {
            setTimeout(analyzeLegacyData, 1000);
        });
    </script>
</body>
</html>